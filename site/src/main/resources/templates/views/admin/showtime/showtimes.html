<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quản lý Showtime - Admin</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
            border: 1px solid rgba(255, 255, 255, 0.18);
        }

        .header h1 {
            color: #4a5568;
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-align: center;
        }

        .header p {
            color: #718096;
            text-align: center;
            font-size: 1.1rem;
        }

        .controls {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
            border: 1px solid rgba(255, 255, 255, 0.18);
        }

        .control-row {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .control-group {
            flex: 1;
            min-width: 200px;
        }

        .control-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #4a5568;
        }

        .control-group select,
        .control-group input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            font-size: 14px;
            transition: all 0.3s ease;
            background: white;
        }

        .control-group select:focus,
        .control-group input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
        }

        .btn-success {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
            color: white;
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(72, 187, 120, 0.3);
        }

        .btn-danger {
            background: linear-gradient(135deg, #f56565 0%, #e53e3e 100%);
            color: white;
        }

        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(245, 101, 101, 0.3);
        }

        .btn-warning {
            background: linear-gradient(135deg, #ed8936 0%, #dd6b20 100%);
            color: white;
        }

        .showtime-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
        }

        .showtime-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
            border: 1px solid rgba(255, 255, 255, 0.18);
            transition: all 0.3s ease;
        }

        .showtime-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(31, 38, 135, 0.4);
        }

        .movie-title {
            font-size: 1.4rem;
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 15px;
        }

        .movie-info {
            margin-bottom: 20px;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .info-label {
            font-weight: 600;
            color: #4a5568;
        }

        .info-value {
            color: #718096;
        }

        .time-slots {
            margin-bottom: 20px;
        }

        .time-slots h4 {
            margin-bottom: 12px;
            color: #4a5568;
            font-size: 1.1rem;
        }

        .time-slot {
            display: inline-block;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 8px 16px;
            border-radius: 25px;
            margin: 4px 8px 4px 0;
            font-size: 14px;
            font-weight: 600;
        }

        .card-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-active {
            background: #c6f6d5;
            color: #22543d;
        }

        .status-inactive {
            background: #fed7d7;
            color: #742a2a;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 20px;
            width: 90%;
            max-width: 600px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .modal h2 {
            margin-bottom: 25px;
            color: #2d3748;
            text-align: center;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #4a5568;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            line-height: 1;
            cursor: pointer;
        }

        .close:hover {
            color: #667eea;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
            border: 1px solid rgba(255, 255, 255, 0.18);
        }

        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            color: #667eea;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #718096;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            .control-row {
                flex-direction: column;
            }

            .showtime-grid {
                grid-template-columns: 1fr;
            }

            .card-actions {
                justify-content: center;
            }
        }
    </style>
</head>
<body>
<div class="container">
    <!-- Header -->
    <div class="header">
        <h1>🎬 Quản lý Showtime</h1>
        <p>Hệ thống quản lý lịch chiếu phim cho rạp chiếu phim</p>
    </div>

    <!-- Stats -->
    <div class="stats">
        <div class="stat-card">
            <div class="stat-number" id="totalShowtimes">24</div>
            <div class="stat-label">Tổng suất chiếu</div>
        </div>
        <div class="stat-card">
            <div class="stat-number" id="activeMovies">8</div>
            <div class="stat-label">Phim đang chiếu</div>
        </div>
        <div class="stat-card">
            <div class="stat-number" id="todayShows">12</div>
            <div class="stat-label">Suất chiếu hôm nay</div>
        </div>
        <div class="stat-card">
            <div class="stat-number" id="soldTickets">342</div>
            <div class="stat-label">Vé đã bán</div>
        </div>
    </div>

    <!-- Controls -->
    <div class="controls">
        <div class="control-row">
            <div class="control-group">
                <label for="cinemaFilter">Rạp chiếu:</label>
                <select id="cinemaFilter">
                    <option value="">Tất cả rạp</option>
                    <option value="cinema1">CGV Vincom</option>
                    <option value="cinema2">Lotte Cinema</option>
                    <option value="cinema3">Galaxy Cinema</option>
                    <option value="cinema4">BHD Star</option>
                </select>
            </div>
            <div class="control-group">
                <label for="movieFilter">Phim:</label>
                <select id="movieFilter">
                    <option value="">Tất cả phim</option>
                    <option value="movie1">Spider-Man: No Way Home</option>
                    <option value="movie2">Eternals</option>
                    <option value="movie3">Dune</option>
                    <option value="movie4">No Time to Die</option>
                </select>
            </div>
            <div class="control-group">
                <label for="dateFilter">Ngày chiếu:</label>
                <input type="date" id="dateFilter" value="2024-12-20">
            </div>
            <div class="control-group">
                <label for="statusFilter">Trạng thái:</label>
                <select id="statusFilter">
                    <option value="">Tất cả</option>
                    <option value="active">Đang hoạt động</option>
                    <option value="inactive">Tạm dừng</option>
                </select>
            </div>
        </div>
        <div class="control-row">
            <button class="btn btn-primary" onclick="filterShowtimes()">🔍 Lọc dữ liệu</button>
            <button class="btn btn-success" onclick="openAddModal()">➕ Thêm suất chiếu</button>
            <button class="btn btn-warning" onclick="exportData()">📊 Xuất báo cáo</button>
        </div>
    </div>

    <!-- Showtime Grid -->
    <div class="showtime-grid" id="showtimeGrid">
        <!-- Showtime cards will be generated here -->
    </div>
</div>

<!-- Add/Edit Modal -->
<div id="showtimeModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeModal()">&times;</span>
        <h2 id="modalTitle">Thêm suất chiếu mới</h2>
        <form id="showtimeForm">
            <div class="form-group">
                <label for="movieSelect">Chọn phim:</label>
                <select id="movieSelect" required>
                    <option value="">-- Chọn phim --</option>
                    <option value="Spider-Man: No Way Home">Spider-Man: No Way Home</option>
                    <option value="Eternals">Eternals</option>
                    <option value="Dune">Dune</option>
                    <option value="No Time to Die">No Time to Die</option>
                    <option value="The Matrix Resurrections">The Matrix Resurrections</option>
                </select>
            </div>
            <div class="form-group">
                <label for="cinemaSelect">Rạp chiếu:</label>
                <select id="cinemaSelect" required>
                    <option value="">-- Chọn rạp --</option>
                    <option value="CGV Vincom">CGV Vincom</option>
                    <option value="Lotte Cinema">Lotte Cinema</option>
                    <option value="Galaxy Cinema">Galaxy Cinema</option>
                    <option value="BHD Star">BHD Star</option>
                </select>
            </div>
            <div class="form-group">
                <label for="roomSelect">Phòng chiếu:</label>
                <select id="roomSelect" required>
                    <option value="">-- Chọn phòng --</option>
                    <option value="Phòng 1">Phòng 1 (100 ghế)</option>
                    <option value="Phòng 2">Phòng 2 (120 ghế)</option>
                    <option value="Phòng 3">Phòng 3 (80 ghế)</option>
                    <option value="Phòng VIP">Phòng VIP (60 ghế)</option>
                    <option value="Phòng IMAX">Phòng IMAX (200 ghế)</option>
                </select>
            </div>
            <div class="form-group">
                <label for="showDate">Ngày chiếu:</label>
                <input type="date" id="showDate" required>
            </div>
            <div class="form-group">
                <label for="showTimes">Giờ chiếu (cách nhau bởi dấu phẩy):</label>
                <input type="text" id="showTimes" placeholder="09:00, 14:30, 19:00, 21:30" required>
            </div>
            <div class="form-group">
                <label for="ticketPrice">Giá vé (VNĐ):</label>
                <input type="number" id="ticketPrice" placeholder="80000" required>
            </div>
            <div class="form-group">
                <label for="showtimeStatus">Trạng thái:</label>
                <select id="showtimeStatus" required>
                    <option value="active">Đang hoạt động</option>
                    <option value="inactive">Tạm dừng</option>
                </select>
            </div>
            <div style="text-align: center; margin-top: 30px;">
                <button type="button" class="btn btn-primary" onclick="saveShowtime()">💾 Lưu</button>
                <button type="button" class="btn btn-danger" onclick="closeModal()">❌ Hủy</button>
            </div>
        </form>
    </div>
</div>

<script>
    // Sample data
    let showtimes = [
        {
            id: 1,
            movie: "Spider-Man: No Way Home",
            cinema: "CGV Vincom",
            room: "Phòng 1",
            date: "2024-12-20",
            times: ["09:00", "14:30", "19:00", "21:30"],
            price: 95000,
            status: "active",
            soldTickets: 45,
            totalSeats: 100
        },
        {
            id: 2,
            movie: "Eternals",
            cinema: "Lotte Cinema",
            room: "Phòng 2",
            date: "2024-12-20",
            times: ["10:00", "15:00", "20:00"],
            price: 85000,
            status: "active",
            soldTickets: 32,
            totalSeats: 120
        },
        {
            id: 3,
            movie: "Dune",
            cinema: "Galaxy Cinema",
            room: "Phòng IMAX",
            date: "2024-12-20",
            times: ["11:00", "16:30", "21:00"],
            price: 120000,
            status: "active",
            soldTickets: 78,
            totalSeats: 200
        },
        {
            id: 4,
            movie: "No Time to Die",
            cinema: "BHD Star",
            room: "Phòng VIP",
            date: "2024-12-21",
            times: ["13:00", "18:00"],
            price: 150000,
            status: "inactive",
            soldTickets: 25,
            totalSeats: 60
        },
        {
            id: 5,
            movie: "The Matrix Resurrections",
            cinema: "CGV Vincom",
            room: "Phòng 3",
            date: "2024-12-21",
            times: ["12:00", "17:30", "22:00"],
            price: 90000,
            status: "active",
            soldTickets: 38,
            totalSeats: 80
        },
        {
            id: 6,
            movie: "Spider-Man: No Way Home",
            cinema: "Lotte Cinema",
            room: "Phòng 1",
            date: "2024-12-21",
            times: ["08:30", "13:30", "18:30"],
            price: 95000,
            status: "active",
            soldTickets: 67,
            totalSeats: 100
        }
    ];

    let editingId = null;

    function renderShowtimes(data = showtimes) {
        const grid = document.getElementById('showtimeGrid');
        grid.innerHTML = '';

        data.forEach(showtime => {
            const card = document.createElement('div');
            card.className = 'showtime-card';

            const occupancyRate = Math.round((showtime.soldTickets / showtime.totalSeats) * 100);

            card.innerHTML = `
                    <div class="movie-title">${showtime.movie}</div>
                    <div class="movie-info">
                        <div class="info-row">
                            <span class="info-label">Rạp:</span>
                            <span class="info-value">${showtime.cinema}</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Phòng:</span>
                            <span class="info-value">${showtime.room}</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Ngày:</span>
                            <span class="info-value">${new Date(showtime.date).toLocaleDateString('vi-VN')}</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Giá vé:</span>
                            <span class="info-value">${showtime.price.toLocaleString()} VNĐ</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Đã bán:</span>
                            <span class="info-value">${showtime.soldTickets}/${showtime.totalSeats} (${occupancyRate}%)</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Trạng thái:</span>
                            <span class="status-badge ${showtime.status === 'active' ? 'status-active' : 'status-inactive'}">
                                ${showtime.status === 'active' ? 'Hoạt động' : 'Tạm dừng'}
                            </span>
                        </div>
                    </div>
                    <div class="time-slots">
                        <h4>Suất chiếu:</h4>
                        ${showtime.times.map(time => `<span class="time-slot">${time}</span>`).join('')}
                    </div>
                    <div class="card-actions">
                        <button class="btn btn-warning" onclick="editShowtime(${showtime.id})">✏️ Sửa</button>
                        <button class="btn btn-danger" onclick="deleteShowtime(${showtime.id})">🗑️ Xóa</button>
                        <button class="btn btn-primary" onclick="viewDetails(${showtime.id})">👁️ Chi tiết</button>
                    </div>
                `;

            grid.appendChild(card);
        });
    }

    function filterShowtimes() {
        const cinemaFilter = document.getElementById('cinemaFilter').value;
        const movieFilter = document.getElementById('movieFilter').value;
        const dateFilter = document.getElementById('dateFilter').value;
        const statusFilter = document.getElementById('statusFilter').value;

        let filtered = showtimes.filter(showtime => {
            return (!cinemaFilter || showtime.cinema.includes(cinemaFilter)) &&
                (!movieFilter || showtime.movie.includes(movieFilter)) &&
                (!dateFilter || showtime.date === dateFilter) &&
                (!statusFilter || showtime.status === statusFilter);
        });

        renderShowtimes(filtered);
    }

    function openAddModal() {
        editingId = null;
        document.getElementById('modalTitle').textContent = 'Thêm suất chiếu mới';
        document.getElementById('showtimeForm').reset();
        document.getElementById('showtimeModal').style.display = 'block';
    }

    function editShowtime(id) {
        editingId = id;
        const showtime = showtimes.find(s => s.id === id);

        document.getElementById('modalTitle').textContent = 'Chỉnh sửa suất chiếu';
        document.getElementById('movieSelect').value = showtime.movie;
        document.getElementById('cinemaSelect').value = showtime.cinema;
        document.getElementById('roomSelect').value = showtime.room;
        document.getElementById('showDate').value = showtime.date;
        document.getElementById('showTimes').value = showtime.times.join(', ');
        document.getElementById('ticketPrice').value = showtime.price;
        document.getElementById('showtimeStatus').value = showtime.status;

        document.getElementById('showtimeModal').style.display = 'block';
    }

    function saveShowtime() {
        const formData = {
            movie: document.getElementById('movieSelect').value,
            cinema: document.getElementById('cinemaSelect').value,
            room: document.getElementById('roomSelect').value,
            date: document.getElementById('showDate').value,
            times: document.getElementById('showTimes').value.split(',').map(t => t.trim()),
            price: parseInt(document.getElementById('ticketPrice').value),
            status: document.getElementById('showtimeStatus').value
        };

        if (editingId) {
            const index = showtimes.findIndex(s => s.id === editingId);
            showtimes[index] = { ...showtimes[index], ...formData };
            alert('Cập nhật suất chiếu thành công!');
        } else {
            const newShowtime = {
                id: Date.now(),
                ...formData,
                soldTickets: 0,
                totalSeats: 100
            };
            showtimes.push(newShowtime);
            alert('Thêm suất chiếu thành công!');
        }

        closeModal();
        renderShowtimes();
        updateStats();
    }

    function deleteShowtime(id) {
        if (confirm('Bạn có chắc chắn muốn xóa suất chiếu này?')) {
            showtimes = showtimes.filter(s => s.id !== id);
            renderShowtimes();
            updateStats();
            alert('Xóa suất chiếu thành công!');
        }
    }

    function viewDetails(id) {
        const showtime = showtimes.find(s => s.id === id);
        alert(`Chi tiết suất chiếu:\n\nPhim: ${showtime.movie}\nRạp: ${showtime.cinema}\nPhòng: ${showtime.room}\nNgày: ${showtime.date}\nGiờ chiếu: ${showtime.times.join(', ')}\nGiá vé: ${showtime.price.toLocaleString()} VNĐ\nĐã bán: ${showtime.soldTickets}/${showtime.totalSeats} vé`);
    }

    function closeModal() {
        document.getElementById('showtimeModal').style.display = 'none';
    }

    function exportData() {
        const data = showtimes.map(s => ({
            'Phim': s.movie,
            'Rạp': s.cinema,
            'Phòng': s.room,
            'Ngày': s.date,
            'Giờ chiếu': s.times.join('; '),
            'Giá vé': s.price,
            'Đã bán': s.soldTickets,
            'Tổng ghế': s.totalSeats,
            'Trạng thái': s.status === 'active' ? 'Hoạt động' : 'Tạm dừng'
        }));

        console.log('Xuất dữ liệu:', data);
        alert('Dữ liệu đã được xuất! (Kiểm tra Console)');
    }

    function updateStats() {
        const totalShowtimes = showtimes.length;
        const activeMovies = new Set(showtimes.filter(s => s.status === 'active').map(s => s.movie)).size;
        const today = new Date().toISOString().split('T')[0];
        const todayShows = showtimes.filter(s => s.date === today).length;
        const soldTickets = showtimes.reduce((sum, s) => sum + s.soldTickets, 0);

        document.getElementById('totalShowtimes').textContent = totalShowtimes;
        document.getElementById('activeMovies').textContent = activeMovies;
        document.getElementById('todayShows').textContent = todayShows;
        document.getElementById('soldTickets').textContent = soldTickets;
    }

    // Close modal when clicking outside
    window.onclick = function(event) {
        const modal = document.getElementById('showtimeModal');
        if (event.target === modal) {
            closeModal();
        }
    }

    // Set default date to today
    document.getElementById('showDate').value = new Date().toISOString().split('T')[0];
    document.getElementById('dateFilter').value = new Date().toISOString().split('T')[0];

    // Initialize
    renderShowtimes();
    updateStats();
</script>
</body>
</html>